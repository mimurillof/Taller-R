"0","# Obtener medias posteriores para predicciones"
"0","alpha_mean <- stats[grep(""alpha \\["", rownames(stats)), ""Mean""]"
"0","beta_mean <- stats[grep(""beta \\["", rownames(stats)), ""Mean""]"
"0",""
"0","# Calcular predicciones y residuos"
"0","returns_long <- returns_long %>%"
"0","  group_by(Sector_Index) %>%"
"0","  mutate("
"0","    Predicted_Return = alpha_mean[Sector_Index] + beta_mean[Sector_Index] * SPY,"
"0","    Residual = Sector_Return - Predicted_Return"
"0","  ) %>%"
"0","  ungroup()"
"0",""
"0","# Gráfico de residuos vs valores ajustados"
"0","residual_plot <- ggplot(returns_long, aes(x = Predicted_Return, y = Residual)) +"
"0","  geom_point(alpha = 0.3, size = 0.8, color = ""steelblue"") +"
"0","  geom_hline(yintercept = 0, color = ""red"", linetype = ""dashed"", linewidth = 1) +"
"0","  facet_wrap(~ Sector_Label) +"
"0","  labs("
"0","    title = ""Análisis de Residuos por Sector"","
"0","    subtitle = ""Verificación de supuestos del modelo"","
"0","    x = ""Retorno Predicho (Valores Ajustados)"","
"0","    y = ""Residuos"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    plot.title = element_text(size = 14, face = ""bold""),"
"0","    strip.text = element_text(size = 11, face = ""bold"")"
"0","  )"
"0",""
"0","print(residual_plot)"
