"0","# Preparar datos para análisis exploratorio"
"0","if (""SPY"" %in% colnames(returns_df)) {"
"0","  returns_long <- returns_df %>%"
"0","    pivot_longer(cols = -SPY,"
"0","                 names_to = ""Sector"","
"0","                 values_to = ""Sector_Return"")"
"0","  "
"0","  # Crear mapeo de sectores a nombres descriptivos"
"0","  sector_labels <- c("
"0","    ""XLE"" = ""Energía"", "
"0","    ""XLF"" = ""Finanzas"", "
"0","    ""XLK"" = ""Tecnología"", "
"0","    ""XLP"" = ""Consumo Básico"""
"0","  )"
"0","  "
"0","  returns_long <- returns_long %>%"
"0","    mutate(Sector_Label = factor(sector_labels[Sector], "
"0","                                levels = c(""Energía"", ""Finanzas"", ""Tecnología"", ""Consumo Básico"")))"
"0","  "
"0","  # Gráfico principal de relaciones"
"0","  exploratory_plot <- ggplot(returns_long, aes(x = SPY, y = Sector_Return)) +"
"0","    geom_point(alpha = 0.3, color = ""steelblue"", size = 0.8) +"
"0","    geom_smooth(method = ""lm"", se = TRUE, color = ""red"", linewidth = 1) +"
"0","    facet_wrap(~ Sector_Label, ncol = 2, scales = ""free"") +"
"0","    labs("
"0","      title = ""Relación de Retornos Sectoriales vs. Mercado (S&P 500)"","
"0","      subtitle = ""Datos diarios: Enero 2018 - Diciembre 2024"","
"0","      x = ""Retornos del Mercado (SPY)"","
"0","      y = ""Retornos del Sector"","
"0","      caption = ""Fuente: Yahoo Finance. Análisis propio."""
"0","    ) +"
"0","    theme_minimal() +"
"0","    theme("
"0","      plot.title = element_text(size = 14, face = ""bold""),"
"0","      plot.subtitle = element_text(size = 12),"
"0","      strip.text = element_text(size = 11, face = ""bold"")"
"0","    ) +"
"0","    geom_hline(yintercept = 0, linetype = ""dashed"", color = ""gray50"", alpha = 0.7) +"
"0","    geom_vline(xintercept = 0, linetype = ""dashed"", color = ""gray50"", alpha = 0.7)"
"0","  "
"0","  print(exploratory_plot)"
"0","}"
